<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>To-Do List jS</title>
	<link rel="stylesheet" href="style.css">

	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Jost:wght@200;300;400&display=swap" rel="stylesheet">

</head>
<body>
	<div class="header" id="header"></div>

	<div class="main" id="main">
	    <div class="sidebar" id="sidebar">
	        <div class="home">
	            <button class="all-tasks-button" id="allTasksButton">All Tasks</button>
	            <button class="today-button" id="todayButton">Today</button>
	            <button class="next-7-button" id="next7Button">Next 7 Days</button>
	            <button class="important-button" id="importantButton">Important</button>
	        </div>
	        <div class="projects" id="projects">
	            <button class="add-project-button" id="addProjectButton">Add Project</button>
	        </div>
	    </div>
	    <div class="tasks" id="tasks"></div>
	</div>


	<script>
		
		projectsDiv = document.getElementById('projects');
		taskDiv = document.getElementById('tasks');

		allTasksButton = document.getElementById('allTasksButton');
		todayButton = document.getElementById('todayButton');
		next7Button = document.getElementById('next7Button');
		importantButton = document.getElementById('importantButton');
		addProjectButton = document.getElementById('addProjectButton');

		const projects = [];

		function addProject(name) {
			const newProject = { name, isTaskAdded: false, tasks: [] };
			projects.push(newProject);
		}

		addProjectButton.addEventListener("click", function () {
			const projectName = promptWithMaxLength("Digite o nome do projeto: (máx. 12 caracteres) ", 12);

			if (projectName !== null) { // Executar apenas caso o usuário não clique em "cancelar" no prompt
				addProject(projectName);
				
				const lastIndex = projects.length - 1; // Armazena o último índice
				const project = createProject(lastIndex); // Passa o último índice como argumento
				projectsDiv.appendChild(project);

				console.log(projects);
			}

		});

		function createProject(index) {
			const project = document.createElement('div');
			project.classList.add('project');

			// Create a new h2 element for the project
			const projectTitle = document.createElement('h2');
			projectTitle.classList.add('project-title');
			projectTitle.textContent = projects[index].name;
			console.log(projectTitle.textContent);

			const deleteProject = document.createElement('div');
			deleteProject.classList.add('delete-project');
			deleteProject.addEventListener('click', () => {
				// Encontrar o projeto pai do botão delete
				const projectElement = event.target.closest('.project');

				// Remover o projeto da array
				removeProject(projects.find(project => project.name === projectElement.querySelector('.project-title').textContent));

				// Remover o elemento do DOM
				projectsDiv.removeChild(project);
				
				const taskHeader = document.querySelector('.task-header');

				if ((taskDiv.innerHTML === '') || (taskHeader.innerHTML === projectTitle.textContent)) {
					taskDiv.innerHTML = '';
					console.log(projects);
				}

			});

			// Append the title and the delete-button to the project div
			project.appendChild(projectTitle);
			project.appendChild(deleteProject);

			projectTitle.addEventListener('click', () => addTask(projectTitle.textContent));

			return project;
		}

		function addTask(projectName) {

			// Clear existing content in taskDiv
			taskDiv.innerHTML = '';	

			const taskHeader = document.createElement('h2');
			taskHeader.classList.add('task-header');
			taskHeader.textContent = projectName;

			// Create a new div for "(edit)"
			const editDiv = document.createElement('div');
			editDiv.textContent = '(edit)';

			// Create a new div for "Add Task"
			const addTaskDiv = document.createElement('div');
			addTaskDiv.classList.add('add-task');
			addTaskDiv.id = 'addTask';
			addTaskDiv.textContent = '+ Add Task';
			addTaskDiv.addEventListener('click', () => { 
				const project = projects.find(proj => proj.name === projectName);
				if (project) {

					const newTask = prompt("Digite a nova tarefa: ");
					if (newTask) {
						project.tasks.push(newTask);
						
						// Adiciona um "remove-task"
						const removeTask = document.createElement('div');
						removeTask.textContent = '(remove-task)';
						removeTask.classList.add('remove-task');
						removeTask.addEventListener('click', () => {
							taskDiv.removeChild(newDiv);
							taskDiv.removeChild(editTask);

							const taskIndex = project.tasks.indexOf(newTask);
							
							if (taskIndex !== -1) { project.tasks.splice(taskIndex, 1) }
							
							taskDiv.removeChild(removeTask);
						});

						// Adiciona um "edit-task"
						const editTask = document.createElement('div');
						editTask.textContent = '(edit task)';
						editTask.classList.add('edit-task');
						editTask.addEventListener('click', () => {
							const editTaskPrompt = prompt("Edite o nome da tarefa: ");

							if (editTaskPrompt !== null) { 
								newDiv.textContent = editTaskPrompt;
								const taskIndex = project.tasks.indexOf(newTask);
								if (taskIndex !== -1) { project.tasks[taskIndex] = editTaskPrompt; }
							}
						});

						// Adiciona a nova task
						const newDiv = document.createElement('div');
						newDiv.textContent = newTask;

						taskDiv.appendChild(removeTask);
						taskDiv.appendChild(editTask);
						taskDiv.appendChild(newDiv);

					}
				}
			})

			// Create a separate div for each task
			const addedTaskDiv = document.createElement('div');
			addedTaskDiv.classList.add('task-div')

			// Append the elements to addedTaskDiv
			addedTaskDiv.appendChild(taskHeader);
			addedTaskDiv.appendChild(editDiv);
			addedTaskDiv.appendChild(addTaskDiv);

			// Append the addedTaskDiv to the taskDiv
			taskDiv.appendChild(addedTaskDiv);

			const project = projects.find(proj => proj.name === projectName);
			if (project && project.tasks.length > 0) {
				project.tasks.forEach(task => {
					const newTaskDiv = document.createElement('div');
					newTaskDiv.textContent = task;
					newTaskDiv.classList.add('task');

					// Adiciona um novo "edit-task"
					const newEditTask = document.createElement('div');
					newEditTask.textContent = '(edit task)';
					newEditTask.classList.add('new-edit-task');
					newEditTask.addEventListener('click', () => {
						// Lógica para edição ou outras ações desejadas ao clicar na tarefa	
						const editTaskPrompt = prompt("Edite o nome da tarefa: ");

						if (editTaskPrompt !== null) {
							newTaskDiv.textContent = editTaskPrompt;
							const taskIndex = project.tasks.indexOf(task);
							if (taskIndex !== -1) { project.tasks[taskIndex] = editTaskPrompt; }
						}
					});


					// Adiciona um novo "remove-task"
					const newRemoveTask = document.createElement('div');
					newRemoveTask.textContent = '(remove-task)';
					newRemoveTask.classList.add('new-remove-task');
					newRemoveTask.addEventListener('click', () => {
						taskDiv.removeChild(newTaskDiv);
						taskDiv.removeChild(newEditTask);

						const taskIndex = project.tasks.indexOf(task);

						if (taskIndex !== -1) { project.tasks.splice(taskIndex, 1) }

						taskDiv.removeChild(newRemoveTask);
					});

					taskDiv.appendChild(newRemoveTask);
					taskDiv.appendChild(newEditTask)
					taskDiv.appendChild(newTaskDiv);
				});
			}					

			
		}
			
		function removeProject(project) {
			const projectIndex = projects.indexOf(project);

			if (projectIndex !== -1) {
				projects.splice(projectIndex, 1);
			}
		}

		function promptWithMaxLength(message, maxLength) {
			let userInput;

			do {
				userInput = prompt(message);
				if (userInput && userInput.length > maxLength) {
					alert(`O texto não pode ter mais que ${maxLength} caracteres. Por favor, tente novamente.`);
				}
			} while (userInput && userInput.length > maxLength);

			return userInput;
		}

	</script>
</body>
</html>
